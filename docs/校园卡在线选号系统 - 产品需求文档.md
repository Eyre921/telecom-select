**版本 V1-Production**

  

## 1. 项目概述

  

### 1.1. 项目背景

  

当前，中国电信校园卡暑期前置营销流程依赖于手动操作：客户在静态在线文档中查找未被预定的号码，然后联系营销人员，通过微信支付完成预定，最后营销人员手动更新表格。整个过程效率低下，易于出错，且客户体验不佳。为了优化流程、提升效率和客户满意度，我们开发了一个集号码展示、在线选择、订单管理于一体的在线选号系统。

  

### 1.2. 产品目标

  

- **提升客户体验：** 为客户提供一个直观、便捷、自助的在线选号和预定平台
    
- **提高营销效率：** 自动化处理订单信息，减少营销人员手动操作，使其能专注于核心营销工作
    
- **加强数据管理：** 集中管理号码库存、订单信息和物流状态，确保数据实时、准确，为管理员提供全面的数据洞察
    
- **规范业务流程：** 建立标准化的线上营销流程，并支持对历史数据的平滑迁移与整合
    
      
    

### 1.3. 目标用户

  

- **客户 （C 端用户）:** 主要是寻求办理校园卡的学生群体
    
- **营销人员 （B 端用户）:** 负责跟进客户订单、确认收款和提供客户支持
    
- **管理员 （B 端用户）:** 负责整个系统的号码管理、订单监控和数据维护
    
      
    

## 2. 用户角色与权限

  

系统包含三个核心角色，各自拥有不同的操作权限。

|   |   |   |
|---|---|---|
|角色|核心职责|权限说明|
|客户|在线浏览、选择号码并提交预定信息|- 无需登录<br><br><br>- 浏览所有"未预定"状态的号码<br><br><br>- 可切换"一键屏蔽已选号码"开关<br><br><br>- 点选号码，选择支付方式（20 元定金/200 元全款）<br><br><br>- 填写并提交个人信息（姓名、联系电话、收货地址等）|
|营销人员|处理和跟进客户订单，**审核新订单**|- 需要账号密码登录<br><br><br>- 查看所有订单的详细信息，特别是"待审核"列表<br><br><br>- 可以修改除"号码"本身之外的所有字段<br><br><br>- 可以将订单状态从"审核中"修改为"已预定"<br><br><br>- 可以手动释放超时的待审核订单|
|管理员|系统的最高权限拥有者，负责全部数据和系统的维护|- 需要账号密码登录<br><br><br>- 拥有所有权限，包括审核、查看、修改、添加、删除所有的号码和订单信息<br><br><br>- 可以批量导入新号码（系统自动分析是否靓号）<br><br><br>- 拥有强大的批量数据导入与合并更新功能<br><br><br>- 可以导出数据为 CSV 或 Excel 格式|

  

## 3. 产品功能详述

  

### 3.1. 客户端功能 （C-Side）

  

**3.1.1. 号码展示页**

  

- **界面布局：** 采用响应式网格（Grid）布局清晰地展示号码列表，完美适配 PC 和移动端
    
- **无限滚动：** 实现了高性能的无限滚动加载，每页加载 100 个号码，提升用户体验
    
- **号码状态标识：**
    
    - **可选号码：** 正常显示，可点击
        
    - **靓号：** 特殊样式高亮（红色边框），并可标注靓号原因
        
    - **审核中/已预定：** 号码置灰，添加"已被锁定"蒙层或标签，不可点击
        
          
        
- **核心功能：**
    
    - **"一键屏蔽已选号码"开关：** 开启后，所有"审核中"和"已预定"的号码将从列表中隐藏
        
    - **智能搜索：** 支持号码模糊搜索，实时过滤显示结果
        
    - **一键复制号码：** 每个号码卡片上提供复制按钮，方便客户复制号码
        
          
        

**3.1.2. 选号与下单流程**

  

1. **选择号码：** 客户点击心仪的、状态为"可选"的号码
    
2. **弹出下单窗口 （Modal）：** 显示所选号码，提供交单方式选择
    
3. **填写信息表单：** 根据所选交单方式，填写姓名、电话、地址等信息
    
4. **提交订单与支付：**
    
    1. 客户点击"提交"按钮，系统使用数据库事务确保并发安全
        
    2. 系统记录客户信息，并将号码状态更新为"审核中"
        
    3. 页面显示成功提示和后续操作指引
        
          
        

### 3.2. 管理后台功能 （B-Side）

  

**3.2.1. 身份认证系统**

  

- 基于 NextAuth.js 实现的安全登录系统
    
- 支持密码加密存储
    
- 角色权限控制（ADMIN/MARKETER）
    
- 会话管理和自动登出
    
      
    

**3.2.2. 订单/号码管理仪表盘**

  

- **核心视图：**
    
    - **数据统计面板：** 页面顶部展示核心数据卡片，如：`总号码数`、`剩余可选`、`今日新增订单`、`待审核订单数`
        
    - **"待审核订单"模块：**
        
        - **高亮与倒计时：** 每条待审核订单用不同颜色背景高亮，并显示"已下单 XX 分钟"的实时计时器
            
        - **超时订单识别：** 自动标识下单超过 30 分钟的订单为"已超时"
            
        - **批量操作：** 支持批量释放超时订单
            
    - **主数据表格：** 功能强大的数据表格，支持排序、分页、字段显示控制
        
          
        
- **核心功能：**
    
    - **订单审核：** 可将`预定状态`从"审核中"修改为"已预定"
        
    - **手动释放订单：**
        
        - **批量释放：** 一键释放所有超时订单
            
        - **单个释放：** 针对特定订单的手动释放
            
    - **行内编辑：** 支持快速修改各个字段
        
    - **高级筛选：** 支持按状态、时间等条件筛选
        
          
        

**3.2.3. 批量数据导入与更新 （仅管理员）**

  

- **多格式支持：** 支持表格 1、表格 2 和自定义格式的数据导入
    
- **智能字段映射：** 可视化字段选择和拖拽排序
    
- **数据预览：** 导入前可预览数据格式和内容
    
- **合并更新逻辑：** 以"号码"为唯一键，进行新增或合并更新
    
- **详细日志：** 提供详细的导入日志和错误报告
    
- **靓号自动识别：** 系统自动分析并标记靓号
    
      
    

**3.2.4. 数据导出功能**

  

- **灵活字段选择：** 可自定义选择要导出的字段
    
- **多种格式：** 支持 CSV 和 Excel 格式导出
    
- **数据排序：** 支持按指定字段排序导出
    
- **枚举值翻译：** 自动将数据库枚举值翻译为中文
    
      
    

## 4. 关键工作流与数据模型

  

### 4.1. 订单审核与资源释放工作流

  

1. **锁定：** 客户提交订单，`reservationStatus` 变为 `PENDING_REVIEW`，`orderTimestamp` 被记录
    
2. **审核：** 营销人员/管理员在后台监控"待审核"订单。收到客户支付凭证后，找到对应订单，补充支付信息，并将 `reservationStatus` 修改为 `RESERVED`
    
3. **自动超时识别：** 系统自动识别下单超过 30 分钟的订单并标记为"已超时"
    
4. **手动释放：** 营销人员/管理员可以通过"单个释放"或"批量释放"按钮来执行释放操作
    
      
    

### 4.2. 数据模型 （数据库表结构）

  

**核心表：PhoneNumber**

  

|   |   |   |   |
|---|---|---|---|
|字段名 （Field Name）|数据类型 （Data Type）|描述|备注|
|`id`|String (CUID)|唯一标识符|主键|
|`phoneNumber`|String|手机号码|唯一索引|
|`isPremium`|Boolean|是否为靓号|**由系统在添加时自动判断**|
|`premiumReason`|String|靓号原因|**由系统在添加时自动填充**|
|`reservationStatus`|Enum|预定状态|**'UNRESERVED', 'PENDING_REVIEW', 'RESERVED'**|
|`orderTimestamp`|DateTime|下单时间|**用于计算 30 分钟超时**|
|`paymentAmount`|Float|收款金额|20.00， 200.00， 或 NULL|
|`paymentMethod`|Enum|支付方式|'WECHAT', 'ALIPAY', 'CASH', 'OTHER', NULL|
|`transactionId`|String|交易订单号|可为空|
|`assignedMarketer`|String|负责的营销人员||
|`customerName`|String|客户姓名||
|`customerContact`|String|客户联系方式||
|`shippingAddress`|String|客户收货地址||
|`emsTrackingNumber`|String|EMS 单号||
|`deliveryStatus`|Enum|号码状态/物流状态|'EMPTY', 'IN_TRANSIT_UNACTIVATED', 'IN_TRANSIT_ACTIVATED', 'RECEIVED_UNACTIVATED'|
|`createdAt`|DateTime|记录创建时间||
|`updatedAt`|DateTime|记录最后更新时间||

  

**用户管理表：User**

  

|   |   |   |   |
|---|---|---|---|
|字段名|数据类型|描述|备注|
|`id`|String|唯一标识符|主键|
|`name`|String|用户姓名||
|`email`|String|邮箱地址|唯一索引|
|`password`|String|加密密码||
|`role`|Enum|用户角色|'ADMIN', 'MARKETER'|

  

## 5. 技术实现特色

  

### 5.1. 前端技术栈

- **Next.js 14：** 使用 App Router 和 Server Components
    
- **React 18：** 现代化的 React Hooks 和状态管理
    
- **TypeScript：** 全面的类型安全
    
- **Tailwind CSS：** 响应式设计和现代化 UI
    
- **Prisma Client：** 类型安全的数据库操作
    
      
    

### 5.2. 后端技术栈

- **Next.js API Routes：** 服务端 API 实现
    
- **NextAuth.js：** 身份认证和会话管理
    
- **Prisma ORM：** 数据库操作和迁移
    
- **SQLite：** 轻量级数据库（生产环境可切换至 PostgreSQL）
    
      
    

### 5.3. 核心技术特性

- **并发安全：** 使用数据库事务防止号码重复预定
    
- **实时更新：** 前端状态与后端数据实时同步
    
- **性能优化：** 无限滚动、分页加载、智能缓存
    
- **数据完整性：** 完善的数据验证和错误处理
    
- **安全性：** 密码加密、权限控制、输入验证
    
      
    

## 6. 部署与运维

  

### 6.1. 部署配置

- **环境变量：** 完善的环境变量配置
    
    - `DATABASE_URL`：数据库连接字符串
        
    - `NEXTAUTH_URL`：应用域名
        
    - `NEXTAUTH_SECRET`：JWT 签名密钥
        
    - `NODE_ENV`：运行环境
        
    - `PORT`：服务端口
        
          
        

### 6.2. 生产环境优化

- **静态文件优化：** 使用 Next.js Standalone 模式
    
- **进程管理：** 使用 PM2 进行进程管理和监控
    
- **数据库备份：** 定期备份 SQLite 数据库
    
- **日志监控：** 完善的错误日志和访问日志
    
      
    

## 7. 非功能性需求

  

- **性能：** 系统响应迅速，即使号码数量上万，客户列表页加载时间也在 2 秒以内
    
- **易用性：** 界面简洁直观，无需培训即可上手操作。特别是后台的"待审核"列表和手动释放功能一目了然
    
- **响应式设计：** 客户前端完美适配手机、平板和桌面浏览器。管理后台优先适配桌面端，关键功能在移动端也可用
    
- **安全性：** 后台进行身份验证和权限控制，防止未授权访问和操作。所有用户输入都进行安全过滤，防止 XSS、SQL 注入等攻击
    
- **可扩展性：** 系统架构具备良好的扩展性，便于未来增加新功能
    
- **数据一致性：** 使用数据库事务确保数据一致性，防止并发问题
    
      
    

## 8. 后续版本规划

  

### 8.1. V1.1 计划

- 后台增加数据统计图表（每日订单量、营销人员业绩统计、靓号预定比例等）
    
- 增加操作日志，记录关键操作（订单审核、数据导入、手动释放），方便追溯
    
- 优化移动端体验，增加手势操作
    
      
    

### 8.2. V2.0 愿景

- 集成微信/支付宝原生支付接口，实现支付状态自动确认
    
- 增加订单状态变更的短信/微信通知功能，自动通知客户审核结果、发货状态等
    
- 增加客户端订单查询功能
    
- 支持多租户架构，服务多个营销团队
    
      
    

---

  

**文档版本：** V-Final-Production

**最后更新：** 2025 年 8 月

**系统状态：** 已部署生产环境，运行稳定